<!doctype HTML>
<html>
<head>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
    <script src="https://raw.githack.com/jeromeetienne/AR.js/2.0.5/aframe/build/aframe-ar.js"></script>
    <script src="https://rawgit.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
    <script>
        AFRAME.registerComponent('video', {
            init: function () {
                this.toggle = true;
                document.querySelector("#video").pause();

                document.querySelector("#videoPanel").addEventListener('click', () => {
                    console.log("video clicked");
                    if (!this.toggle) {
                        this.toggle = true;
                        document.querySelector("#video").play();
                    } else {
                        this.toggle = false;
                        document.querySelector("#video").pause();
                    }
                })
            },
        });

        AFRAME.registerComponent('clickhandler', {
            init: function () {
                document.querySelector("#videoButton").addEventListener('click', () => {
                    console.log("button clicked");
                    window.open("https://www.ubs.com/global/en/investment-bank/research-academy.html", "_blank");
                });
            }
        });

        AFRAME.registerComponent('animated', {
            init: function () {
                var marker = document.querySelector("#marker");
                marker.addEventListener("markerFound", () => {
                    if (!this.videoPreped) {
                        this.videoPreped = true;
                        setTimeout(() => document.querySelector("#video").play(), 9000);
                        this.el.emit("markerFound");
                    }
                });
                document.querySelector("#video").addEventListener("ended", () => {
                    this.el.emit("videoFinished");
                });
            }
        });
    </script>
</head>
<body style='margin : 0px; overflow: hidden;'>
<a-scene embedded arjs='patternRatio: 0.75; debugUIEnabled: false; sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;' vr-mode-ui='enabled: false' device-orientation-permission-ui="enabled: false">
    <a-assets>
        <img id="keys" src="/unitywebar/assets/UBS-LogoKEYS.png"/>
        <img id="UBSText" src="/unitywebar/assets/UBS-LogoTEXT.png"/>
        <video id="video" src="/unitywebar/assets/what_is_ra.mp4" crossorigin playsinline controls></video>
    </a-assets>
    <a-entity cursor="use: false; rayOrigin: mouse;" raycaster="objects: .intersectable; useWorldCoordinates: true;">
    </a-entity>
    <a-marker type='pattern' url='https://raw.githubusercontent.com/samchadwick/samchadwick.github.io/master/unitywebar/markers/pattern-happy.patt' id='marker' emitevents='true'>
        <a-plane clickhandler class="intersectable" color="white" rotation="-90 0 0" position="0 -5 0" width="10" height="10"
            material="transparent: true; opacity: 0.8;">
        </a-plane>
        <a-image animated src="#keys" rotation="-90 0 0" width="0.3" height="0.3" depth="0.3" position="0.125 -1 0" scale="0 0 0"
            animation__keys_zoom_in="property: scale; from: 0 0 0; to: 1 1 1; dur: 1500; easing: linear; startEvents: markerFound;"
            animation__keys_move_left="property: position; from: 0.125 -1 0; to: -0.35 -1 0; dur: 1000; delay: 500; easing: linear; startEvents: animationcomplete__keys_zoom_in;"
            animation__keys_fadeout="property: components.material.material.opacity; from: 1.0; to: 0.0; dur: 1000; delay: 2000; startEvents: animationcomplete__keys_move_left;"
            animation__keys_disapear="property: scale; from: 1 1 1; to: 0 0 0; dur: 1; easing: linear; startEvents: animationcomplete__keys_fadeout;"
            animation__keys_relocated="property: position; from: -0.35 -1 0; to: 0 -1 0; dur: 1; easing: linear; startEvents: animationcomplete__keys_fadeout;"
            animation__keys_reapear="property: scale; from: 0 0 0; to: 1 1 1; dur: 1; easing: linear; delay: 3000; startEvents: videoFinished;"
            animation__keys_fadein="property: components.material.material.opacity; from: 0; to: 1; dur: 3000; delay: 3000; startEvents: videoFinished;">
        </a-image>
        <a-image animated src="#UBSText" rotation="-90 0 0" width="0.6" height="0.3" depth="0.3" position="0.1 -1 0" material="opacity: 0;"
            animation__logotext_fadein="property: components.material.material.opacity; from: 0; to: 1; dur: 500; delay: 2500; startEvents: markerFound;"
            animation__logotext_fadeout="property: components.material.material.opacity; from: 1; to: 0; dur: 1000; delay: 2000; startEvents: animationcomplete__logotext_fadein;"
            animation__logotext_disapear="property: scale; from: 1 1 1; to: 0 0 0; dur: 1; easing: linear; startEvents: animationcomplete__logotext_fadeout;">
            <a-text animated value="Research Academy" color="black" position="-0.65 -0.3 0" opacity="0"
                animation__text_fadein="property: text.opacity; from: 0; to: 1; dur: 500; delay: 2500; startEvents: markerFound;"
                animation__text_fadeout="property: text.opacity; from: 1; to: 0; dur: 1000; delay: 2000; startEvents: animationcomplete__text_fadein;"
                animation__text_disapear="property: scale; from: 1 1 1; to: 0 0 0; dur: 1; easing: linear; startEvents: animationcomplete__text_fadeout;"
                scale="0.5 0.5 0.5">
            </a-text>
        </a-image>
        <a-video animated id="videoPanel" video rotation="-90 0 0" src="#video" width="2" height="1.33" position="0 -1 -1" material="opacity: 0;" class="intersectable"
            animation__video_fadein="property: components.material.material.opacity; from: 0; to: 1; dur: 3000; delay: 6000; startEvents: markerFound;"
            animation__video_fadeout="property: components.material.material.opacity; from: 1; to: 0; dur: 3000; startEvents: videoFinished;"
            animation__video_disapear="property: scale; from: 1 1 1; to: 0 0 0; dur: 1; easing: linear; startEvents: animationcomplete__video_fadeout;">
        </a-video>
        <a-plane clickhandler class="intersectable" animated id="videoButton" color="white" rotation="-90 0 0" position="0 -1 0" width="2" height="0.5"
            material="transparent: true; opacity: 0;"
            animation__button_fadein="property: components.material.material.opacity; from: 0; to: 1; dur: 3000; delay: 6000; startEvents: markerFound;"
            animation__button_move="property: position; from: 0 -1 0; to: 0 -1 0.45; dur: 2500; delay: 500; startEvents: videoFinished;">
            <a-text animated id="videoButtonText" value="Click Here to Find Out More" color="black" position="-0.75 0 0.05" scale="0.5 0.5 0.5" opacity="0"
                    animation__buttontext_fadein="property: text.opacity; from: 0; to: 1; dur: 6000; delay: 6000; startEvents: markerFound;">
            </a-text>
        </a-plane>
    </a-marker>
    <a-entity camera></entity>
</a-scene>
</body>
</html>
