<!doctype HTML>
<html>
<head>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://d3js.org/d3.v6.js"></script>
    <script src="/scripts/d3graph.js"></script>
    <script>
        // modify the THREE.js materials to allow for model opacity
        AFRAME.registerComponent('model-opacity', {
          schema: {default: 1.0},
          init: function () {
            this.el.addEventListener('model-loaded', this.update.bind(this));
          },
          update: function () {
            var mesh = this.el.getObject3D('mesh');
            var data = this.data;
            if (!mesh) { return; }
            mesh.traverse(function (node) {
              if (node.isMesh) {
                node.material.opacity = data;
                node.material.transparent = data < 1.0;
                node.material.needsUpdate = true;
              }
            });
          }
        });
        // Video play and pause on-click
        AFRAME.registerComponent('video', {
            init: function () {
                document.querySelector("#video").pause();
                document.querySelector("#videoPanel").addEventListener('click', () => {
                    document.querySelector("#video").play();
                })
                document.querySelector("#videoPanel").addEventListener('mouseleave', () => {
                    document.querySelector("#video").pause();
                })
            },
        });
        // Graph component
        AFRAME.registerComponent('graph3', {
            init: function () {
                setInterval(getEthPrice, 60000);
                getEthPrice();
            }
        });
        AFRAME.registerComponent('graph2', {
            init: function () {
                var data = d3.range(10).map(function (d, i) {
                    return {v: Math.random()}
                });

                setInterval(() => {
                    data = d3.range(10).map(function (d, i) {
                        return {v: Math.random()}
                    });
                    update(data, "2")
                }, 5000);
                update(data, "2");
            }
        });
    </script>

</head>
<body>
    <div style="position: relative">
      <p style="position: fixed; bottom: 0; width:100%; text-align: center">Move your device from side to side</p>
    </div>
<a-scene>
    <a-assets>
        <img id="groundTexture" src="https://cdn.aframe.io/a-painter/images/floor.jpg">
        <a-asset-item src="https://cdn.aframe.io/fonts/Roboto-msdf.json"></a-asset-item>
        <a-asset-item id="threekeys-obj" src="/assets/threekeys.obj"></a-asset-item>
        <a-asset-item id="threekeys-mtl" src="/assets/threekeys.mtl"></a-asset-item>
        <a-asset-item id="arrow-obj" src="/assets/arrow.obj"></a-asset-item>
        <a-asset-item id="arrow-mtl" src="/assets/arrow.mtl"></a-asset-item>
        <video id="video" src="/assets/intro_movie.mp4" crossorigin="anonymous" playsinline controls></video>
    </a-assets>
    <a-plane src="#groundTexture" rotation="-90 0 0"position="0 -6.5 0" width="30" height="30"></a-plane>
    <a-entity cursor="fuse: true; fuseTimeout: 500; rayOrigin: mouse;"></a-entity>
    <a-entity obj-model="obj:#threekeys-obj; mtl:#threekeys-mtl" 
            scale="0.01 0.018 0.01"
            position="0 1.5 -10"
            rotation="90 90 90"
            animation="property: rotation; to: 90 450 90; dur: 10000"
            light="type:directional; castShadow:true;" position="0 0 1" shadow="receive: true"></a-entity>
    <a-text value="Welcome to the UBS Research Academy" color="black" align="center" opacity="0"
            position="0 1.2 -1" scale="0.2 0.2 0.2"
            animation__text_fadein="property: text.opacity; from: 0; to: 1; dur: 1000; delay: 1000;"
            ></a-text>
    <a-text value="Pan right to continue" color="black" align="center" opacity="0"
            position="0 1.1 -1" scale="0.1 0.1 0.1"
            animation__text_fadein="property: text.opacity; from: 0; to: 1; dur: 1000; delay: 2000;"
            ></a-text>
    <a-entity obj-model="obj:#arrow-obj; mtl:#arrow-mtl" model-opacity="0"
            scale="0.5 0.5 0.5"
            position="-0.1 -0.1 -2.5"
            rotation="90 90 90"
            animation="property: position; from: -2 0 -2.5; to: 1 0 -2.5; dur: 3000; loop: true;"
            animation__text_fadein="property: model-opacity; from: 0.0; to: 1.0; dur: 500; delay: 2000;"
            light="type:directional; castShadow:true;" position="0 0 1" shadow="receive: true">
            </a-entity>
    <a-video id="videoPanel" video src="#video" rotation="0 -90 0" width="2" height="1.125"
            position="2 1.5 0"></a-video>
    <a-entity graph2 id="bars2" group-opacity="opacity: 1" width="8" height="1"
              position="0 1.1 3" material="opacity: 1;" class="intersectable"></a-entity>
</a-scene>

</body>
</html>

