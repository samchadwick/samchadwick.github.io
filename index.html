<!doctype HTML>
<html>
	<head>
		<meta name="apple-mobile-web-app-capable" content="yes">
		<script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
		<script src="https://raw.githack.com/jeromeetienne/AR.js/2.0.5/aframe/build/aframe-ar.js"></script>
		<script>

			// Get the Feed
		  	async function getFeed(source){
				let r = fetch("https://cors-anywhere.herokuapp.com/" + source, {
					headers: {
						"Access-Control-Allow-Origin": "*",
						"Access-Control-Allow-Headers": "*"
					}
				})
				  .then(response => response.text())
				  .then(str => new window.DOMParser().parseFromString(str, "text/xml"))
				  .catch((err) => {
	        		console.log(err.message);
	      		});
	      		return await r;
		  	}

		  	// Update the text items with the stories and links
		  	async function buildStories(feed){
		  		const feedArray = await getFeed(feed);
	  			const items = feedArray.querySelectorAll("item");
			    var i = 1;
			    for (const each of items) {
			    	// Set text
			    	var title = await each.querySelector("title").innerHTML.replace("<![CDATA[", "").replace("]]>", "");
			    	var item = document.querySelector("#item"+i);
				    item.setAttribute('value', title);
				    // Set link
		    		var target = document.querySelector("#link"+i);
			      	target.addEventListener('click', async function () {
			      		var link = await each.querySelector("link").innerHTML;
			        	window.open(link, '_blank');
			      	});
					i++;
					if (i > 5) { break; }
			    }
		  	}

		  	// Register components
		  	i = 1;
		  	while (i < 6) {
		  		AFRAME.registerComponent('item'+i, {
				  init: function(){
			    	this.el.setAttribute('value', 'Loading RSS Feed...');
				  }
				});
			  i++;
			}

			// Add link to image			
	  		AFRAME.registerComponent('image1', {
			  init: function(){
		    	this.el.addEventListener('click', (e) => {
		        	window.open(this.data.url, '_blank');
				  })
				}
			});

	  		AFRAME.registerComponent('image2', {
			  init: function(){
		    	this.el.addEventListener('click', (e) => {
		        	window.open(this.data.url, '_blank');
				  })
				}
			});

	  		AFRAME.registerComponent('image3', {
			  init: function(){
		    	this.el.addEventListener('click', (e) => {
		        	window.open(this.data.url, '_blank');
				  })
				}
			});
			
		</script>
	</head>
	<body style='margin : 0px; overflow: scroll;'>
	  <a-scene embedded arjs='patternRatio: 0.69; debugUIEnabled: false;'>
			<a-assets>
				<img id="image001" src="/assets/image001.jpeg" crossorigin="anonymous">
				<img id="image002" src="/assets/image002.jpeg" crossorigin="anonymous">
				<img id="person" src="/assets/person-outline.jpg" crossorigin="anonymous">
			</a-assets>
			<a-marker type='pattern' url='/pattern-happy.patt' emitevents='true' cursor='rayOrigin: mouse'>

				<!-- Left Column -->

				<a-plane color="black" rotation="-90 0 0" position="-2.7 -0.2 -3.8" width="2" height="0.5" material="transparent: true; opacity: 0.90"></a-plane>
				<a-text value="Contact" color="white" rotation="-90 0 0" position="-3.4 0 -3.8" scale="0.5 0.5 0.5"></a-text>

				<a-image image3="url: https://linkedin.com" src="#person" rotation="-90 0 0" position="-2.7 -0.2 -2.45" width="2" height="2"></a-image>

				<a-plane color="white" rotation="-90 0 0" position="-2.7 -0.2 -1" width="2" height="0.5" material="transparent: true; opacity: 0.90"></a-plane>
				<a-text value="Email" color="black" rotation="-90 0 0" position="-3.4 0 -1" scale="0.5 0.5 0.5"></a-text>

				<a-plane color="white" rotation="-90 0 0" position="-2.7 -0.2 -0.4" width="2" height="0.45" material="transparent: true; opacity: 0.90"></a-plane>
				<a-text value="Phone" color="black" rotation="-90 0 0" position="-3.4 0 -0.4" scale="0.5 0.5 0.5"></a-text>

				<!-- Center Column -->

				<a-plane color="black" rotation="-90 0 0" position="0 -0.2 -3.8" width="3" height="0.5" material="transparent: true; opacity: 0.90"></a-plane>
				<a-text value="Latest News" color="white" rotation="-90 0 0" position="-1.2 0 -3.8" scale="0.5 0.5 0.5"></a-text>

				<a-plane id="link1" color="white" rotation="-90 0 0" position="0 -0.2 -3.2" width="3" height="0.5" material="transparent: true; opacity: 0.90"></a-plane>
				<a-text item1 id="item1" value="" color="black" rotation="-90 0 0" position="-1.2 0 -3.2" scale="0.5 0.5 0.5"></a-text>

				<a-plane id="link2" color="white" rotation="-90 0 0" position="0 -0.2 -2.6" width="3" height="0.45" material="transparent: true; opacity: 0.90"></a-plane>
				<a-text item2 id="item2" value="" color="black" rotation="-90 0 0" position="-1.2 0 -2.6" scale="0.5 0.5 0.5"></a-text>

				<a-plane id="link3" color="white" rotation="-90 0 0" position="0 -0.2 -2" width="3" height="0.5" material="transparent: true; opacity: 0.90"></a-plane>
				<a-text item3 id="item3" value="" color="black" rotation="-90 0 0" position="-1.2 0 -2" scale="0.5 0.5 0.5"></a-text>

				<a-plane id="link4" color="white" rotation="-90 0 0" position="0 -0.2 -1.4" width="3" height="0.5" material="transparent: true; opacity: 0.90"></a-plane>
				<a-text item4 id="item4" value="" color="black" rotation="-90 0 0" position="-1.2 0 -1.4" scale="0.5 0.5 0.5"></a-text>

				<a-plane id="link5" color="white" rotation="-90 0 0" position="0 -0.2 -0.8" width="3" height="0.5" material="transparent: true; opacity: 0.90"></a-plane>
				<a-text item5 id="item5" value="" color="black" rotation="-90 0 0" position="-1.2 0 -0.8" scale="0.5 0.5 0.5"></a-text>

				<a-plane color="black" rotation="-90 0 0" position="0 -0.2 -0.2" width="3" height="0.5" material="transparent: true; opacity: 0.90"></a-plane>
				<a-text value="Featured Articles" color="white" rotation="-90 0 0" position="-1.2 0 -0.2" scale="0.5 0.5 0.5"></a-text>

				<a-image image1="url: https://google.com" src="#image001" rotation="-90 0 0" position="0 -0.2 1.15" width="3" height="2"></a-image>

				<a-plane color="white" rotation="-90 0 0" position="0 -0.2 2.55" width="3" height="0.7" material="transparent: true; opacity: 0.90"></a-plane>
				<a-text value="Navigating markets.  The COVID-19 outbreak has created an 'overnight' global shutdown without precedent, and without much certainty as to its resolution." color="black" rotation="-90 0 0" position="-1.2 0 2.5" scale="0.5 0.5 0.5"></a-text>

				<a-image image2="url: https://google.com" src="#image002" rotation="-90 0 0" position="0 -0.2 4" width="3" height="2"></a-image>

				<a-plane color="white" rotation="-90 0 0" position="0 -0.2 5.5" width="3" height="0.8" material="transparent: true; opacity: 0.90"></a-plane>
				<a-text value="Panorama webinar: A short, sharp shock or prolonged pain? Our investment experts forecast potential market opportunities in a post COVID-19 world." color="black" rotation="-90 0 0" position="-1.2 0 5.5" scale="0.5 0.5 0.5"></a-text>

				<!-- Right Column -->

			</a-marker>
	    	<a-entity camera></entity>
	  	</a-scene>
	</body>
	<script>
		var feed = 'http://feeds.bbci.co.uk/news/business/rss.xml';
		buildStories(feed);
	</script>
</html>
